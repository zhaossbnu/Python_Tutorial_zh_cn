\documentclass[a4paper,11pt,twoside]{book}
%\usepackage[fancyhdr,fntef,space]{ctexcap} %由于代码中的引号问题 暂时弃用
\usepackage{xeCJK}
\usepackage[compact]{titlesec} % 标题设置  不用ctexcap的情况下 compact缩减标题前后的空白
\usepackage{titletoc} % 目录设 置在不用ctexcap的情况下
\usepackage{tocloft} % 目录设 置在不用ctexcap的情况下
\usepackage[tracking=alltext,letterspace=20]{microtype} % 字距修改
\usepackage{float}
\usepackage{caption}
\usepackage{xcolor}
\usepackage{enumerate} % 为列表提供可选参数
\usepackage{paralist} % 行间距相对紧凑的列表环境
\usepackage{graphicx}
\usepackage{comment}
\usepackage{fancybox}
\usepackage{listings} % 代码打印
\usepackage{lastpage} % 最后一页页码
\usepackage{fontspec}
\usepackage{tabularx}
\usepackage{colortbl} % 彩色表格
\usepackage{nameref} % 层次标题引用
%\usepackage{tocbibind} %将目录、参考文献加入目录
\usepackage[toc,lof,lot]{multitoc} % 目录 插图 表格目录多栏 toc->目录 lof->图目录 lot->表目录
%\usepackage{makeidx} % 索引
%\makeindex
%\usepackage{framed}
\definecolor{mylinkcolor}{RGB}{53,95,124}
\definecolor{myurlcolor}{RGB}{55,112,99}
\usepackage{hyperref}
\hypersetup{
    pagebackref,
    xetex,
    CJKbookmarks,
    bookmarksnumbered,
    bookmarksopen,
    colorlinks,
    linkcolor=mylinkcolor,
    urlcolor=myurlcolor,
    pdfpagemode=UseOutlines,
    pdfstartview=FitV,
    pdftitle={Python 教程},
    pdfauthor={zhaossbnu}
}
\usepackage[left=2.5cm,right=2.0cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage{fancyvrb}
\usepackage[perpage,stable]{footmisc} %标题中可以有脚注 脚注按页重置
\usepackage{cprotect} %命令保护
%\usepackage{showidx} % 在正文的左边显示索引 用于校对
\usepackage{fancyhdr}
\setmainfont[BoldFont={timesbd.ttf},ItalicFont={timesi.ttf},BoldItalicFont={timesbi.ttf}]{times.ttf}
\setsansfont[BoldFont={texgyreheros-bold.otf},ItalicFont={texgyreheros-italic.otf},BoldItalicFont={texgyreheros-bolditalic.otf}]{texgyreheros-regular.otf}
\setmonofont[BoldFont={courbd.ttf},ItalicFont={couri.ttf},BoldItalicFont={courbi.ttf}]{cour.ttf}
\setCJKmainfont[BoldFont={simhei.ttf}, ItalicFont={simkai.ttf}]{simsun.ttc}
\setCJKsansfont[BoldFont={msyhbd.ttf}]{msyh.ttf}
\setCJKmonofont{simfang.ttf} % 这个只是为了应对代码中显示文字

\setCJKfamilyfont{kaishu}{[simkai.ttf]}
\newcommand{\kaishu}{\CJKfamily{kaishu}}
\newcommand*{\textkaishu}[1]{\CJKfamily{kaishu} #1}
\setCJKfamilyfont{fangsong}{[simfang.ttf]}
\newcommand{\fangsong}{\CJKfamily{fangsong}}
\newcommand*{\textfangsong}[1]{\CJKfamily{fangsong} #1}
\setCJKfamilyfont{lishu}{[simli.ttf]}
\newcommand{\lishu}{\CJKfamily{lishu}}
\newcommand*{\textlishu}[1]{\CJKfamily{lishu} #1}
\setCJKfamilyfont{youyuan}{[simyou.ttf]}
\newcommand{\youyuan}{\CJKfamily{youyuan}}
\newcommand*{\textyouyuan}[1]{\CJKfamily{youyuan} #1}

\renewcommand{\Nameref}[1]{\textcolor{mylinkcolor}{\textit{\ref{#1}~\nameref{#1}~第\pageref{#1}页}}}
\linespread{1.25} % 1.5倍行距
\parindent=2.2em % 段落缩进两个汉字
%\baselineskip = 17.68pt 这个只能在正文中其作用
\setcounter{tocdepth}{3} % 设置目录显示深度
%\renewcommand{\abstractname}{摘要}
\renewcommand{\appendixname}{附录}
\renewcommand{\bibname}{参考文献}
\renewcommand{\chaptername}{\bfseries 第~\thechapter~章}
\renewcommand{\contentsname}{\hspace*{\fill}目\quad 录\hspace*{\fill}}
\renewcommand{\indexname}{索引}
\renewcommand{\listfigurename}{插图}
\renewcommand{\listtablename}{表格}
% 页面版式设置
\pagestyle{fancy} % 覆盖默认版式
\fancyhf{} %  清空原有设置
\fancyhead[ER,OL]{\nouppercase{\leftmark}} %左页的右页眉 右页的左页眉   正文章节以前的
\fancyhead[EL,OR]{\nouppercase{\rightmark}} %左页的左页眉 右页的右页眉  小节
\fancyfoot[C]{\thepage} % 左页和右页的中页脚
% 以上配置不会改变 章节首页的版式（plain）

% 层次标题设置 ctexcap宏包
%\CTEXsetup[number={\arabic{chapter}}]{chapter}
%\CTEXsetup[format+={\flushleft}]{section} % section标题左对齐
\titleformat{\chapter}{\bf\centering\huge}{第~\thechapter~章}{20pt}{\bf}

\renewcommand\cftdot{$\cdot$}
\renewcommand\cftdotsep{2}

\settowidth\cftchapnumwidth{第99章}
\renewcommand\cftchappresnum{第}
\renewcommand\cftchapaftersnum{章}
\renewcommand\cftchapaftersnumb{\hspace{0.5em}}
\renewcommand\cftsecaftersnumb{\hspace{0.5em}}

\setlength{\columnsep}{30pt} % 两栏目录间隔30pt
\lstset{
	%backgroundcolor=\color[rgb]{0.9,0.9,0.9}, %设置背景颜色
    language=Python,
    tabsize=4,    %tab大小
    basicstyle=\ttfamily\small,	% 代码字体 大小
    upquote=true,
    aboveskip={0.5\baselineskip}, %距离上文的距离
    columns=flexible,
    extendedchars=false,
    breaklines=true,
    %frame=single, % 代码加边框
    showtabs=false, % 显示tab
    showspaces=false, %显示空格
    showstringspaces=false, %显示字符串中的空格
    identifierstyle=\ttfamily, %
    language={Python},
    keywordstyle=\color[RGB]{0,112,33},% 关键字颜色
    commentstyle=\itshape\color[RGB]{64,128,143}, % 注释颜色
    stringstyle=\color[RGB]{64,112,161},% 字符串颜色
    morekeywords={False,None,True,nonlocal,with,as,yield,assert,range,len,list,set}, % 添加默认关键字表中没有的关键字
    otherkeywords={>>>,...,+,-,*,\%,/,=,<,<=,>=,==,0,1,2,3,4,5,6,7,8,9}, % 其他关键字主要是符号和数字
    emph={if,else,elif,for,in,break,continue,while,True,False,pass,def,class,from,import}, emphstyle={\bfseries\color[RGB]{0,112,33}}, % 加粗的关键字颜色
    emph={[2]\$,>>>,...}, emphstyle={[2]\bfseries\color[RGB]{199,92,10}}, % 主提示符颜色
    emph={[3]+,-,*,/,\%,=,<,<=,==}, emphstyle={[3]\color[RGB]{102,102,102}}, % 运算符的颜色
    emph={[4]0,1,2,3,4,5,6,7,8,9}, emphstyle={[4]\color[RGB]{33,128,79}},  % 数字的颜色
    %escapeinside={\{}{\}}, % if you want to add LaTeX within your code
    % title=\lstname % 显示用\lstinputlisting导入的文件名
}

\newenvironment{Warning}[1]{%
\par \noindent\raisebox{0.5\baselineskip}[2pt]{\rule{\textwidth}{1pt}}\vspace{-0.5\baselineskip}%
\begin{compactdesc}
\item[#1:]}
{\end{compactdesc}\noindent\raisebox{0.5\baselineskip}[2pt]{\rule{\textwidth}{1pt}}\vspace{-0.5\baselineskip}\par} 